<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="Style.css">
</head>
<script type="text/javascript">
    function getRadioClicked(name) {
        /*
        * This function takes in a (usually shared) name used for a question and 
        * iterates over the radio buttons that share it to find out which one is clicked.
        * Only one can be clicked per due to how radio buttons work, so there aren't any errors
        *  Takes in a string, returns a string (the id of the button, which is being used to represent the value of the answer from 0 to 3)
        */
        let choices = document.getElementsByName(name);
        var val = "";
        for (let i = 0; i < choices.length; i++) {
            if (choices[i].checked)
                val = choices[i].id;
        }
        return val
    }

    function fillRandom() {
        /*
        * This function randomly inputs data into the form; this is for debug use
        */
        for (let i = 1; i <= 17; i++) {
            let num = Math.floor(Math.random() * 4);
            if (i == 9) {
                num = num % 2;
            }
            document.getElementsByName("q"+i)[num].checked=true
        }
    }

    function calculate() {
        /*
        * This function is called when the form is submitted.
        * If a question is not answered, it will fail and alert the user.
        * Otherwise, it'll calculate total score and edit the score label with it.
        * Ideally, this will be handled differently later and score won't just be a number added up
        */
        var total = 0;
        var destination = document.getElementById("total");
        for (let i = 1; i <= 17; i++) {
            let num = getRadioClicked("q" + i);
            if (num == "") {
                alert("You didnt answer question #" + i);
                return;
            }
            num = Number(num)
            if (i == 9)
                num *= 2;
            total += num;
        }
        destination.innerHTML = String(total);
    }

</script>
<body>
    <h1>Questionnaire Page</h1>
    <p>The questions come from <a href="https://www.nhs.uk/mental-health/self-help/guides-tools-and-activities/depression-anxiety-self-assessment-quiz/">The NHS</a></p>
    <button id = "login" >Login w/ Google</button>
    <button id = "signoff" >Sign Out</button>
    <p id = "user-info">You are <strong>not</strong> signed in.</p>
    <script>
        //These are the functions to change the background and font colors to allow users an option to ease their eyes

        function blackOnWhite() {
            document.body.style.color = "black";
            document.body.style.backgroundColor = "white";
        }
        function greenOnWhite() {
            document.body.style.color = "#003300";
            document.body.style.backgroundColor = "white";
        }
        function blueOnWhite() {
            document.body.style.color = "#000033";
            document.body.style.backgroundColor = "white";
        }
        function umberOnWhite() {
            document.body.style.color = "#330000";
            document.body.style.backgroundColor = "white";
        }
        function whiteOnGray() {
            document.body.style.color = "#FFFFFF";
            document.body.style.backgroundColor = "#333333"
        }
        function cyanOnBlack() {
            document.body.style.color = "#00FFFF";
            document.body.style.backgroundColor = "black";
        }
        function silverOnBlack() {
            document.body.style.color = "#CCCCCC";
            document.body.style.backgroundColor = "black";
        }
        function palette() { //the function to reveal the palette and hide the palette button
            document.getElementById("paletteSelector").style.display = "block";
            document.getElementById("paletteButton").style.display = "none";
        }
        function hidePalette() { //function to hide the palette again and to reveal the button
            document.getElementById("paletteSelector").style.display = "none";
            document.getElementById("paletteButton").style.display = "block";
        }
    </script>

    <p id="paletteButton">
        <button onclick="palette()">Color Palette</button><br />
    </p>

    <p id="paletteSelector" style="display: none">
        <button onclick="blackOnWhite()">Black font White Background</button><br />
        <button onclick="greenOnWhite()">Green font White Background</button><br />
        <button onclick="blueOnWhite()">Blue font White Background</button><br />
        <button onclick="umberOnWhite()">Umber font White Background</button><br />
        <button onclick="whiteOnGray()">White font Gray Background</button><br />
        <button onclick="cyanOnBlack()">Cyan font Black Background</button><br />
        <button onclick="silverOnBlack()">Silver font Black Background</button><br />
        <button onclick="hidePalette()">Hide Palette</button>
    </p>

    <form name="questions">
        1. How often have you been bothered by feeling down, depressed or hopeless?<br>
        <input type="radio" id="0" name="q1">Not at all<br>
        <input type="radio" id="1" name="q1">Several Days<br>
        <input type="radio" id="2" name="q1">More than half the days<br>
        <input type="radio" id="3" name="q1">Nearly every day<br>
        2. How often have you had little interest or pleasure in doing things?<br>
        <input type="radio" id="0" name="q2">Not at all<br>
        <input type="radio" id="1" name="q2">Several Days<br>
        <input type="radio" id="2" name="q2">More than half the days<br>
        <input type="radio" id="3" name="q2">Nearly every day<br>
        3. How often have you been bothered by trouble falling or staying asleep, or sleeping too much?<br>
        <input type="radio" id="0" name="q3">Not at all<br>
        <input type="radio" id="1" name="q3">Several Days<br>
        <input type="radio" id="2" name="q3">More than half the days<br>
        <input type="radio" id="3" name="q3">Nearly every day<br>
        4. How often have you been bothered by feeling tired or having little energy?<br>
        <input type="radio" id="0" name="q4">Not at all<br>
        <input type="radio" id="1" name="q4">Several Days<br>
        <input type="radio" id="2" name="q4">More than half the days<br>
        <input type="radio" id="3" name="q4">Nearly every day<br>
        5. How often have you been bothered by poor appetite or overeating?<br>
        <input type="radio" id="0" name="q5">Not at all<br>
        <input type="radio" id="1" name="q5">Several Days<br>
        <input type="radio" id="2" name="q5">More than half the days<br>
        <input type="radio" id="3" name="q5">Nearly every day<br>
        6. How often have you been bothered by feeling bad about yourself, or that you are a failure, or have let yourself or your family down?<br>
        <input type="radio" id="0" name="q6">Not at all<br>
        <input type="radio" id="1" name="q6">Several Days<br>
        <input type="radio" id="2" name="q6">More than half the days<br>
        <input type="radio" id="3" name="q6">Nearly every day<br>
        7. How often have you been bothered by trouble concentrating on things, such as reading the newspaper or watching television?<br>
        <input type="radio" id="0" name="q7">Not at all<br>
        <input type="radio" id="1" name="q7">Several Days<br>
        <input type="radio" id="2" name="q7">More than half the days<br>
        <input type="radio" id="3" name="q7">Nearly every day<br>
        8. How often have you been bothered by moving or speaking so slowly that other people could have noticed, or the opposite - being so fidgety or restless that you have been moving around a lot more than usual?<br>
        <input type="radio" id="0" name="q8">Not at all<br>
        <input type="radio" id="1" name="q8">Several Days<br>
        <input type="radio" id="2" name="q8">More than half the days<br>
        <input type="radio" id="3" name="q8">Nearly every day<br>
        9. Have you had an anxiety attack (suddenly feeling fear or panic)?<br>
        <input type="radio" id="1" name="q9">Yes<br>
        <input type="radio" id="0" name="q9">No<br>
        10. How often have you been bothered by feeling nervous, anxious or on edge?<br>
        <input type="radio" id="0" name="q10">Not at all<br>
        <input type="radio" id="1" name="q10">Several Days<br>
        <input type="radio" id="2" name="q10">More than half the days<br>
        <input type="radio" id="3" name="q10">Nearly every day<br>
        11. How often have you been bothered by not being able to stop or control worrying?<br>
        <input type="radio" id="0" name="q11">Not at all<br>
        <input type="radio" id="1" name="q11">Several Days<br>
        <input type="radio" id="2" name="q11">More than half the days<br>
        <input type="radio" id="3" name="q11">Nearly every day<br>
        12. How often have you been bothered by worrying too much about different things?<br>
        <input type="radio" id="0" name="q12">Not at all<br>
        <input type="radio" id="1" name="q12">Several Days<br>
        <input type="radio" id="2" name="q12">More than half the days<br>
        <input type="radio" id="3" name="q12">Nearly every day<br>
        13. How often have you been bothered by having trouble relaxing?<br>
        <input type="radio" id="0" name="q13">Not at all<br>
        <input type="radio" id="1" name="q13">Several Days<br>
        <input type="radio" id="2" name="q13">More than half the days<br>
        <input type="radio" id="3" name="q13">Nearly every day<br>
        14. How often have you been bothered by being so restless that it is hard to sit still?<br>
        <input type="radio" id="0" name="q14">Not at all<br>
        <input type="radio" id="1" name="q14">Several Days<br>
        <input type="radio" id="2" name="q14">More than half the days<br>
        <input type="radio" id="3" name="q14">Nearly every day<br>
        15. How often have you been bothered by becoming easily annoyed or irritable?<br>
        <input type="radio" id="0" name="q15">Not at all<br>
        <input type="radio" id="1" name="q15">Several Days<br>
        <input type="radio" id="2" name="q15">More than half the days<br>
        <input type="radio" id="3" name="q15">Nearly every day<br>
        16. How often have you been bothered by feeling afraid as if something awful might happen?<br>
        <input type="radio" id="0" name="q16">Not at all<br>
        <input type="radio" id="1" name="q16">Several Days<br>
        <input type="radio" id="2" name="q16">More than half the days<br>
        <input type="radio" id="3" name="q16">Nearly every day<br>
        17. If this questionnaire has highlighted any problems, how difficult have these problems made it for you to do your work, take care of things at home, or get along with other people?<br>
        <input type="radio" id="0" name="q17">Not difficult at all<br>
        <input type="radio" id="1" name="q17">Somewhat difficult<br>
        <input type="radio" id="2" name="q17">Very difficult<br>
        <input type="radio" id="3" name="q17">Extremely difficult<br>

        Total points (this is for debugging): <label id="total">0</label>
        <input type="button" name="submit" onclick="calculate();" value="Calculate!">
    </form>
    <button name="fill random" onclick="fillRandom();">Fill with random answers</button>    
    <script type="module">

        //!!!!!!!!!!!!!!!!!!!!!DONT PUT DISPLAYED STUFF IN HERE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-analytics.js";
        import { getAuth, signOut, signInWithPopup, GoogleAuthProvider} from "https://www.gstatic.com/firebasejs/9.14.0/firebase-auth.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
      
        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
          apiKey: "AIzaSyDHnJYWxwO4jlsGbAAuHvE977m_TIWFEs8",
          authDomain: "mhcheck-f5182.firebaseapp.com",
          projectId: "mhcheck-f5182",
          storageBucket: "mhcheck-f5182.appspot.com",
          messagingSenderId: "104901433458",
          appId: "1:104901433458:web:14acf9ea7be44e84d88aeb",
          measurementId: "G-WRXQXF8FYG"
        };

        
      
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app)
        const analytics = getAnalytics(app);
        const provider = new GoogleAuthProvider(app);

        login.addEventListener('click',(e) =>{//for whatever has id = 'login'

            signInWithPopup(auth, provider)
                .then((result) => {
                    // This gives you a Google Access Token. You can use it to access the Google API.
                    const credential = GoogleAuthProvider.credentialFromResult(result);
                    const token = credential.accessToken;
                    // The signed-in user info.
                    const user = result.user;


                    //user info
                    //photo = photoURL
                    //name = displayName
                    //email = email
                    alert(user.displayName);
                    document.getElementById("user-info").innerHTML = "Signed in as <strong>" + user.displayName + "<strong>"
                    // ...
                }).catch((error) => {
                    // Handle Errors here.
                    const errorCode = error.code;
                    const errorMessage = error.message;
                    // The email of the user's account used.
                    const email = error.customData.email;
                    // The AuthCredential type that was used.
                    const credential = GoogleAuthProvider.credentialFromError(error);
                    // ...

                    alert(errorMessage);
                });
               

        });

        signoff.addEventListener('click',(e) =>{

            signOut(auth).then(() => { 
                alert("signed out") 
                document.getElementById("user-info").innerHTML = "You are <b>not</b> signed in."
        
            }).catch((error) => { 

                //console.log(error)
                alert(errorMessage);
            });


        });

        /*function checkAuthState(){

            firebase.auth().onStateChanged(user=>{

                if(user){
                    showUserDetails(user)
                    //document.getElementById('user-info').innerHTML = '<p> Name:  ${user} </p>'
                    alert(user.displayName)
                }else{
                    
                }
            })
        }*/


        checkAuthState()
        
    </script>
    
</body>
</html>
